--Question 1: Write a query to calculate the average earnings per hour spent dashing by day of week.

SELECT
  -- Extract the day of the week, e.g., 'Monday'
  DATE_FORMAT(dash_start_time, '%W') AS day_of_week,
  -- Calculate the average earnings per hour for each day of the week by dividing the total pay by the total number of hours between the start and end times of the dash.
  (SUM(total_pay) / SUM(TIMESTAMPDIFF(HOUR, dash_start_time, dash_end_time))) AS avg_earnings_per_hour
FROM Dash
-- Group the results by the day of the week so that we get a separate average for each day.
GROUP BY day_of_week;



--QUESTION 2: Write a query to see how many dashes and deliveries were generated for each zip code in submarket 13. 

SELECT
  -- Select the zipcode from the Dasher table.
  D.zipcode,
  -- Count the number of unique dash IDs to find the number of dashes per zipcode.
  COUNT(DISTINCT Dash.dash_id) AS num_dashes,
  -- Sum the number of deliveries for all dashes within each zipcode.
  SUM(Dash.number_of_deliveries) AS total_deliveries
FROM Dasher AS D
-- Join the Dash table on dasher_id to get access to the dash details.
JOIN Dash ON D.id = Dash.dasher_id
-- Only consider records where the submarket ID is 13.
WHERE D.submarket_id = 13
-- Group the results by zipcode so that we get counts and sums for each individual zipcode.
GROUP BY D.zipcode;




--QUESTION 3: Write a query to identify who the most efficient dasher was in terms of deliveries per time spent dashing during the month of October 2017. 

SELECT
  -- Select the dasher ID to identify the dasher.
  dasher_id,
  -- Calculate the efficiency by finding the sum of all deliveries divided by the total hours dashed.
  SUM(number_of_deliveries) / SUM(TIMESTAMPDIFF(MINUTE, dash_start_time, dash_end_time)) AS efficiency
FROM Dash
-- Filter the dashes to include only those that occurred in October 2017.
WHERE
  dash_start_time BETWEEN '2017-10-01 00:00:00' AND '2017-10-31 23:59:59'
-- Group by dasher ID to calculate the efficiency for each dasher.
GROUP BY dasher_id
-- Order the results by efficiency in descending order to get the most efficient dasher at the top.
ORDER BY efficiency DESC
-- Limit the results to only the top result, which is the most efficient dasher.
LIMIT 1;



--Question 4: Write a query to determine what percent of total pay is generated by dashers completing an average of 2 or more deliveries per hour in October 2017?

WITH OctAvg2ormore AS (
  -- Create a temporary result set with each dasher's total pay and average deliveries per hour for October 2017.
  SELECT
    dasher_id,
    SUM(total_pay) AS total_pay,
    SUM(number_of_deliveries) / SUM(TIMESTAMPDIFF(HOUR, dash_start_time, dash_end_time)) AS avg_deliveries_per_hour
  FROM Dash
  WHERE
    dash_start_time BETWEEN '2017-10-01 00:00:00' AND '2017-10-31 23:59:59'
  GROUP BY dasher_id
),
TotalPay AS (
  -- Compute the total pay for all dashers in October 2017.
  SELECT SUM(total_pay) AS total FROM OctAvg2ormore
),
QualifiedDashersPay AS (
  -- Compute the total pay for dashers who averaged 2 or more deliveries per hour.
  SELECT SUM(total_pay) AS total FROM OctAvg2ormore WHERE avg_deliveries_per_hour >= 2
)
-- Select the percentage of the total pay that comes from qualified dashers.
SELECT
  (QualifiedDashersPay.total / TotalPay.total) * 100 AS percent_of_total_pay
FROM TotalPay, QualifiedDashersPay;